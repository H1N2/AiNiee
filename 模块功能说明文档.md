# AiNiee 项目模块功能说明文档

## 项目概述

AiNiee 是一个基于 PyQt5 和 QFluentWidgets 的智能翻译工具，支持多种文件格式的翻译、润色和格式化处理。项目采用模块化架构设计，具有良好的扩展性和可维护性。

## 项目结构

### 1. 根目录文件

#### AiNiee.py
**功能**: 项目主入口文件
- 应用程序启动和初始化
- 全局配置加载和DPI缩放设置
- 启动画面显示和进度更新
- 核心组件初始化（插件管理器、缓存管理器、文件读写器、任务执行器等）
- 主界面窗口创建和显示
- 应用程序事件循环管理

#### hyperscan.py
**功能**: 高性能正则表达式匹配库接口
- 提供基于Intel Hyperscan的高速文本匹配功能
- 用于大规模文本处理和模式匹配优化

#### volc_translator.py
**功能**: 火山引擎翻译API接口
- 火山引擎翻译服务的专用接口实现
- 提供高质量的机器翻译服务

### 2. Base 目录 - 核心基础模块

#### Base.py
**功能**: 项目基础类和事件定义
- 定义全局事件常量（API测试、任务执行、缓存保存、应用更新等）
- 提供基础类Base，包含通用功能和工具方法
- 事件系统的核心定义和管理

#### EventManager.py
**功能**: 全局事件管理器
- 单例模式的事件管理系统
- 事件订阅、取消订阅和触发机制
- 线程安全的事件处理
- 基于PyQt5信号槽的异步事件处理

#### PluginManager.py
**功能**: 插件系统管理器
- 插件动态加载和卸载
- 插件事件注册和优先级管理
- 插件启用状态控制
- 事件广播和插件调用

### 3. ModuleFolders 目录 - 核心功能模块

#### Cache 缓存模块
- **CacheManager.py**: 缓存管理器，提供翻译结果缓存、文件缓存和项目缓存管理
- **CacheFile.py**: 文件级缓存实现，管理单个文件的缓存数据
- **CacheProject.py**: 项目级缓存实现，管理整个翻译项目的缓存
- **CacheItem.py**: 缓存项基础类，定义缓存数据结构
- **BaseCache.py**: 缓存系统基础类，提供通用缓存操作接口

#### FileReader 文件读取模块
- **FileReader.py**: 文件读取器主入口，支持多种文件格式的统一读取接口
- **BaseReader.py**: 文件读取器基础类，定义读取器接口规范
- **AutoTypeReader.py**: 自动类型识别读取器
- **TxtReader.py**: 纯文本文件读取器
- **DocxReader.py**: Word文档读取器
- **EpubReader.py**: EPUB电子书读取器
- **SrtReader.py**: SRT字幕文件读取器
- **VttReader.py**: WebVTT字幕文件读取器
- **LrcReader.py**: LRC歌词文件读取器
- **MdReader.py**: Markdown文件读取器
- **TPPReader.py**: TPP项目文件读取器
- **TransReader.py**: Trans翻译文件读取器
- **MToolReader.py**: MTool游戏翻译文件读取器
- **RenpyReader.py**: Ren'Py游戏脚本读取器
- **VntReader.py**: VNT可视化小说文件读取器
- **I18nextReader.py**: i18next国际化文件读取器
- **PoReader.py**: GNU gettext PO文件读取器
- **ParatranzReader.py**: Paratranz翻译平台文件读取器
- **DirectoryReader.py**: 目录批量读取器
- **OfficeConversionReader.py**: Office文档转换读取器

#### FileOutputer 文件输出模块
- **FileOutputer.py**: 文件输出器主入口，支持多种格式的翻译结果输出
- **BaseWriter.py**: 文件输出器基础类，定义输出器接口规范
- **AutoTypeWriter.py**: 自动类型识别输出器
- **TxtWriter.py**: 纯文本文件输出器
- **DocxWriter.py**: Word文档输出器
- **EpubWriter.py**: EPUB电子书输出器
- **SrtWriter.py**: SRT字幕文件输出器
- **VttWriter.py**: WebVTT字幕文件输出器
- **LrcWriter.py**: LRC歌词文件输出器
- **MdWriter.py**: Markdown文件输出器
- **TPPWriter.py**: TPP项目文件输出器
- **TransWriter.py**: Trans翻译文件输出器
- **MToolWriter.py**: MTool游戏翻译文件输出器
- **RenpyWriter.py**: Ren'Py游戏脚本输出器
- **VntWriter.py**: VNT可视化小说文件输出器
- **I18nextWriter.py**: i18next国际化文件输出器
- **PoWriter.py**: GNU gettext PO文件输出器
- **ParatranzWriter.py**: Paratranz翻译平台文件输出器
- **DirectoryWriter.py**: 目录批量输出器
- **OfficeConversionWriter.py**: Office文档转换输出器
- **WriterUtil.py**: 输出器工具类

#### LLMRequester 大语言模型请求模块
- **LLMRequester.py**: LLM请求器主入口，统一管理各种AI模型接口
- **OpenaiRequester.py**: OpenAI API请求器（GPT系列模型）
- **AnthropicRequester.py**: Anthropic API请求器（Claude系列模型）
- **GoogleRequester.py**: Google AI API请求器（Gemini系列模型）
- **CohereRequester.py**: Cohere API请求器
- **DashscopeRequester.py**: 阿里云灵积API请求器
- **AmazonbedrockRequester.py**: AWS Bedrock API请求器
- **SakuraRequester.py**: Sakura模型专用请求器
- **LocalLLMRequester.py**: 本地LLM模型请求器
- **LLMClientFactory.py**: LLM客户端工厂类，管理客户端实例

#### TaskConfig 任务配置模块
- **TaskConfig.py**: 任务配置管理器，处理翻译任务的各种配置参数
- **TaskType.py**: 任务类型定义，包含翻译、润色、格式化等任务类型

#### TaskExecutor 任务执行模块
- **TaskExecutor.py**: 任务执行器主控制器，协调整个翻译流程
- **TranslatorTask.py**: 翻译任务执行器，处理文本翻译逻辑
- **PolisherTask.py**: 润色任务执行器，处理文本润色逻辑
- **TranslatorUtil.py**: 翻译工具类，提供翻译相关的辅助功能

#### PromptBuilder 提示词构建模块
- **PromptBuilder.py**: 提示词构建器主入口
- **PromptBuilderEnum.py**: 提示词类型枚举定义
- **PromptBuilderFormat.py**: 格式化提示词构建器
- **PromptBuilderLocal.py**: 本地化提示词构建器
- **PromptBuilderPolishing.py**: 润色提示词构建器
- **PromptBuilderSakura.py**: Sakura模型专用提示词构建器

#### RequestLimiter 请求限制模块
- **RequestLimiter.py**: API请求频率限制器，防止超出API调用限制

#### ResponseChecker 响应检查模块
- **ResponseChecker.py**: 响应检查器主入口
- **BaseChecks.py**: 基础检查功能
- **AdvancedChecks.py**: 高级检查功能
- **TranslationChecker.py**: 翻译质量检查器

#### TextProcessor 文本处理模块
- **TextProcessor.py**: 文本处理器，提供文本预处理和后处理功能
- **PolishTextProcessor.py**: 润色文本处理器

#### SimpleExecutor 简单执行器模块
- **SimpleExecutor.py**: 简单任务执行器，处理轻量级任务

#### NERProcessor 命名实体识别模块
- **NERProcessor.py**: 命名实体识别处理器，识别和保护专有名词

#### FileAccessor 文件访问模块
- **BabeldocPdfAccessor.py**: PDF文档访问器
- **DocxAccessor.py**: Word文档访问器
- **EpubAccessor.py**: EPUB文档访问器
- **ZipUtil.py**: ZIP文件处理工具

#### FileConverter 文件转换模块
- **BaseConverter.py**: 文件转换器基础类
- **OfficeFileConverter.py**: Office文档转换器

### 4. UserInterface 目录 - 用户界面模块

#### AppFluentWindow.py
**功能**: 主应用程序窗口
- 基于QFluentWidgets的现代化界面设计
- 导航栏和页面管理
- 主题切换和界面配置
- 自动更新检查功能

#### BaseNavigationItem.py
**功能**: 导航项基础类
- 导航栏项目的基础实现
- 页面切换和状态管理

#### EditView 编辑视图模块
- **EditViewPage.py**: 编辑视图主页面
- **BasicTablePage.py**: 基础表格页面
- **TextViewPage.py**: 文本视图页面
- **TextTranslationDialog.py**: 文本翻译对话框
- **Check/**: 检查功能子模块
- **Search/**: 搜索功能子模块
- **Term/**: 术语管理子模块
- **Timer/**: 定时器功能子模块
- **Monitoring/**: 监控功能子模块
- **Startup/**: 启动配置子模块

#### Platform 平台配置模块
- **PlatformPage.py**: 平台配置主页面
- **APIEditPage.py**: API配置编辑页面
- **ArgsEditPage.py**: 参数编辑页面
- **LimitEditPage.py**: 限制配置页面
- **ModelBrowserDialog.py**: 模型浏览对话框

#### Settings 设置模块
- **AppSettingsPage.py**: 应用程序设置页面
- **TaskSettingsPage.py**: 任务设置页面
- **OutputSettingsPage.py**: 输出设置页面
- **PluginsSettingsPage.py**: 插件设置页面

#### TranslationSettings 翻译设置模块
- **TranslationSettingsPage.py**: 翻译设置主页面
- **SystemPromptPage.py**: 系统提示词页面
- **WritingStylePromptPage.py**: 写作风格提示词页面
- **WorldBuildingPromptPage.py**: 世界观构建提示词页面
- **CharacterizationPromptPage.py**: 角色塑造提示词页面
- **TranslationExamplePromptPage.py**: 翻译示例提示词页面

#### PolishingSettings 润色设置模块
- **PolishingBasicSettingsPage.py**: 润色基础设置页面
- **PolishingSystemPromptPage.py**: 润色系统提示词页面
- **PolishingStylePromptPage.py**: 润色风格提示词页面

#### FormatSettings 格式设置模块
- **FormatSystemPromptPage.py**: 格式化系统提示词页面
- **FormatReferencePage.py**: 格式参考页面

#### Table 表格管理模块
- **TextReplaceAPage.py**: 译前替换表页面
- **TextReplaceBPage.py**: 译后替换表页面
- **PromptDictionaryPage.py**: 提示词字典页面
- **ExclusionListPage.py**: 排除列表页面

#### SentenceTranslation 语句翻译模块
- **SentenceTranslationPage.py**: 语句翻译页面，提供单句翻译功能

#### TranslationAPIDebug API调试模块
- **TranslationAPIDebugPage.py**: 翻译API调试页面
- **TranslationAPIManager.py**: 翻译API管理器

#### Extraction_Tool 提取工具模块
- **Export_Source_Text.py**: 源文本导出工具
- **Import_Translated_Text.py**: 译文导入工具
- **Export_Update_Text.py**: 更新文本导出工具

#### NameExtractor 名称提取模块
- **NameExtractor.py**: 名称提取器，用于提取和管理专有名词

#### TableHelper 表格助手模块
- **TableHelper.py**: 表格操作助手，提供表格相关的辅助功能

#### VersionManager 版本管理模块
- **VersionManager.py**: 版本管理器，处理应用程序版本检查和更新

### 5. Widget 目录 - 自定义控件模块

#### 界面控件组件
- **APITypeCard.py**: API类型选择卡片
- **ActionCard.py**: 操作按钮卡片
- **CombinedLineCard.py**: 组合输入行卡片
- **ComboBoxCard.py**: 下拉框卡片
- **CommandBarCard.py**: 命令栏卡片
- **DashboardCard.py**: 仪表板卡片
- **EditableComboBoxCard.py**: 可编辑下拉框卡片
- **EmptyCard.py**: 空白占位卡片
- **FlowCard.py**: 流式布局卡片
- **FolderDropCard.py**: 文件夹拖拽卡片
- **GameDropCard.py**: 游戏文件拖拽卡片
- **GroupCard.py**: 分组卡片
- **LineEditCard.py**: 单行输入卡片
- **LineEditMessageBox.py**: 输入消息框
- **PlainTextEditCard.py**: 纯文本编辑卡片
- **ProgressRingCard.py**: 进度环卡片
- **PushButtonCard.py**: 按钮卡片
- **SliderCard.py**: 滑块卡片
- **SpinCard.py**: 数值调节卡片
- **SwitchButtonCard.py**: 开关按钮卡片
- **TextEditCard.py**: 多行文本编辑卡片
- **VerticalSeparator.py**: 垂直分隔符
- **WaveformCard.py**: 波形显示卡片
- **InterfaceDropZoneWidget.py**: 界面拖拽区域控件

### 6. PluginScripts 目录 - 插件系统

#### PluginBase.py
**功能**: 插件基础类
- 定义插件接口规范
- 提供插件生命周期管理
- 事件处理机制

#### 内置插件
- **BilingualPlugin/**: 双语显示插件，支持原文和译文对照显示
- **GeneralTextFilter/**: 通用文本过滤插件
- **IOPlugins/**: 输入输出插件，扩展文件格式支持
- **IncrementalFilePlugin/**: 增量文件处理插件
- **LanguageFilter/**: 语言过滤插件
- **MToolOptimizer/**: MTool优化插件
- **SpecialTextFilter/**: 特殊文本过滤插件
- **TextLayoutRepairPlugin/**: 文本布局修复插件
- **TextNormalizer/**: 文本标准化插件
- **TranslationCheckPlugin/**: 翻译检查插件

### 7. Resource 目录 - 资源文件

#### 配置和资源
- **Localization/**: 本地化语言文件
- **Logo/**: 应用程序图标和标志
- **Models/**: AI模型文件（NER、MediaPipe等）
- **Prompt/**: 提示词模板文件
- **Regex/**: 正则表达式配置
- **Updater/**: 更新程序
- **platforms/**: 平台配置文件

### 8. StevExtraction 目录 - 提取工具

#### 专用提取工具
- **main.py**: 提取工具主程序
- **jtpp.py**: JTPP格式处理
- **config.yaml**: 提取工具配置
- **scratchpad.py**: 临时处理脚本

### 9. Tools 目录 - 开发工具

#### 构建和更新工具
- **pyinstall.py**: Python打包工具
- **rust_updater/**: Rust编写的更新程序

### 10. 其他重要文件

#### 配置文件
- **requirements.txt**: Python依赖包列表
- **requirements_no_deps.txt**: 无依赖的包列表
- **.gitignore**: Git忽略文件配置
- **LICENSE**: 项目许可证

#### 文档
- **README.md**: 项目说明文档
- **README_EN.md**: 英文说明文档
- **CODEBUDDY.md**: 代码伙伴文档
- **doc/**: 详细文档目录
  - **API参考文档.md**: API接口文档
  - **使用指南.md**: 用户使用指南
  - **安装部署指南.md**: 安装部署说明
  - **开发者指南.md**: 开发者文档
  - **项目概述.md**: 项目总体介绍

#### 测试文件
- **tests/**: 测试脚本目录
  - 包含各种API测试、功能验证和集成测试脚本

## 技术架构特点

### 1. 模块化设计
- 采用清晰的模块分层架构
- 各模块职责明确，耦合度低
- 支持插件化扩展

### 2. 事件驱动
- 基于事件管理器的松耦合通信
- 支持异步事件处理
- 插件系统基于事件机制

### 3. 多格式支持
- 统一的文件读写接口
- 支持20+种文件格式
- 可扩展的格式支持机制

### 4. 多AI模型集成
- 支持主流AI翻译服务
- 统一的LLM请求接口
- 灵活的模型切换机制

### 5. 现代化界面
- 基于QFluentWidgets的现代UI
- 响应式设计和主题支持
- 丰富的自定义控件

### 6. 高性能优化
- 多线程处理
- 智能缓存机制
- 请求频率限制
- 批量处理优化

## 总结

AiNiee项目是一个功能完整、架构清晰的智能翻译工具，具有良好的扩展性和维护性。项目采用现代化的技术栈和设计模式，为用户提供了强大而易用的翻译解决方案。